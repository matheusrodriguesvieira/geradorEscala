
var operadores = [
    {
        id: 1,
        nome: "matheus",
        turma: "d",
        habilitado: {
            d11: true,
            ehgp: false,
            dragline: false,
            cat777: false,
        },
        disponivel: true,
    },
    {
        id: 2,
        nome: "kemily",
        turma: "d",
        habilitado: {
            d11: true,
            ehgp: false,
            dragline: false,
            cat777: false,
        },
        disponivel: true,
    },
    {
        id: 3,
        nome: "gerson",
        turma: "d",
        habilitado: {
            d11: true,
            ehgp: false,
            dragline: false,
            cat777: false,
        },
        disponivel: true,
    },
    {
        id: 4,
        nome: "jose ferreira",
        turma: "d",
        habilitado: {
            d11: true,
            ehgp: false,
            dragline: false,
            cat777: false,
        },
        disponivel: true,
    },
    {
        id: 5,
        nome: "cleidiane",
        turma: "d",
        habilitado: {
            d11: true,
            ehgp: false,
            dragline: false,
            cat777: false,
        },
        disponivel: true,
    },
    {
        id: 7,
        nome: "roque colato",
        turma: "d",
        habilitado: {
            d11: false,
            ehgp: false,
            dragline: false,
            cat777: true,
        },
        disponivel: true,
    },
    {
        id: 8,
        nome: "andrew",
        turma: "d",
        habilitado: {
            d11: false,
            ehgp: false,
            dragline: false,
            cat777: true,
        },
        disponivel: true,
    },
    {
        id: 9,
        nome: "fernando sarmento",
        turma: "d",
        habilitado: {
            d11: false,
            ehgp: true,
            dragline: false,
            cat777: false,
        },
        disponivel: true,
    },
    {
        id: 10,
        nome: "helitom",
        turma: "d",
        habilitado: {
            d11: true,
            ehgp: false,
            dragline: false,
            cat777: false,
        },
        disponivel: true,
    },
    {
        id: 11,
        nome: "siromar",
        turma: "d",
        habilitado: {
            d11: true,
            ehgp: false,
            dragline: false,
            cat777: false,
        },
        disponivel: true,
    },
    {
        id: 12,
        nome: "elivaldo",
        turma: "d",
        habilitado: {
            d11: false,
            ehgp: true,
            dragline: false,
            cat777: true,
        },
        disponivel: true,
    },
    {
        id: 13,
        nome: "evaldo",
        turma: "d",
        habilitado: {
            d11: true,
            ehgp: true,
            dragline: false,
            cat777: false,
        },
        disponivel: true,
    },
    {
        id: 14,
        nome: "renato",
        turma: "d",
        habilitado: {
            d11: true,
            ehgp: true,
            dragline: false,
            cat777: false,
        },
        disponivel: true,
    },
    {
        id: 15,
        nome: "gilsom",
        turma: "d",
        habilitado: {
            d11: true,
            ehgp: true,
            dragline: false,
            cat777: false,
        },
        disponivel: true,
    },
    {
        id: 16,
        nome: "marcos gomes",
        turma: "d",
        habilitado: {
            d11: true,
            ehgp: false,
            dragline: false,
            cat777: true,
        },
        disponivel: true,
    },
    {
        id: 17,
        nome: "judson",
        turma: "d",
        habilitado: {
            d11: true,
            ehgp: false,
            dragline: false,
            cat777: true,
        },
        disponivel: true,
    },
    {
        id: 18,
        nome: "lucivaldo",
        turma: "d",
        habilitado: {
            d11: true,
            ehgp: false,
            dragline: false,
            cat777: true,
        },
        disponivel: true,
    },
    {
        id: 19,
        nome: "paulo jose",
        turma: "d",
        habilitado: {
            d11: true,
            ehgp: false,
            dragline: false,
            cat777: true,
        },
        disponivel: true,
    },
    {
        id: 20,
        nome: "wilsom",
        turma: "d",
        habilitado: {
            d11: true,
            ehgp: false,
            dragline: false,
            cat777: true,
        },
        disponivel: true,
    },
    {
        id: 21,
        nome: "josias",
        turma: "d",
        habilitado: {
            d11: true,
            ehgp: false,
            dragline: false,
            cat777: true,
        },
        disponivel: true,
    },
    {
        id: 22,
        nome: "luis neto",
        turma: "d",
        habilitado: {
            d11: true,
            ehgp: false,
            dragline: false,
            cat777: false,
        },
        disponivel: true,
    },
    {
        id: 23,
        nome: "francisco vieira",
        turma: "d",
        habilitado: {
            d11: true,
            ehgp: true,
            dragline: false,
            cat777: false,
        },
        disponivel: true,
    },
    {
        id: 24,
        nome: "francisco de assis",
        turma: "d",
        habilitado: {
            d11: true,
            ehgp: true,
            dragline: false,
            cat777: true,
        },
        disponivel: true,
    },
    {
        id: 25,
        nome: "samuelson",
        turma: "d",
        habilitado: {
            d11: true,
            ehgp: true,
            dragline: false,
            cat777: true,
        },
        disponivel: true,
    },
    {
        id: 26,
        nome: "braga",
        turma: "d",
        habilitado: {
            d11: true,
            ehgp: true,
            dragline: false,
            cat777: true,
        },
        disponivel: true,
    },
    {
        id: 27,
        nome: "luis sobrinho",
        turma: "d",
        habilitado: {
            d11: true,
            ehgp: true,
            dragline: true,
            cat777: false,
        },
        disponivel: true,
    },
];

var equipamentos = [
    {
        id: 1,
        tag: 'te8020',
        categoria: "d11",
        disponivel: true,
    },
    {
        id: 2,
        tag: 'eh9501',
        categoria: "ehgp",
        disponivel: true,
    },
    {
        id: 3,
        tag: 'cb6501',
        categoria: "cat777",
        disponivel: true,
    },
    {
        id: 4,
        tag: 'te8024',
        categoria: "d11",
        disponivel: true,
    },
    {
        id: 5,
        tag: 'te8026',
        categoria: "d11",
        disponivel: true,
    },
    {
        id: 6,
        tag: 'te8027',
        categoria: "d11",
        disponivel: true,
    },
    {
        id: 7,
        tag: 'te8028',
        categoria: "d11",
        disponivel: true,
    },
    {
        id: 8,
        tag: 'te8029',
        categoria: "d11",
        disponivel: true,
    },
    {
        id: 9,
        tag: 'te8030',
        categoria: "d11",
        disponivel: true,
    },
    {
        id: 10,
        tag: 'te8031',
        categoria: "d11",
        disponivel: true,
    },
    {
        id: 11,
        tag: 'te8032',
        categoria: "d11",
        disponivel: true,
    },
    {
        id: 12,
        tag: 'te8033',
        categoria: "d11",
        disponivel: true,
    },
    {
        id: 13,
        tag: 'te8034',
        categoria: "d11",
        disponivel: true,
    },
    {
        id: 14,
        tag: 'te8035',
        categoria: "d11",
        disponivel: true,
    },
    {
        id: 15,
        tag: 'te8036',
        categoria: "d11",
        disponivel: true,
    },
    {
        id: 16,
        tag: 'te8037',
        categoria: "d11",
        disponivel: true,
    },
    {
        id: 17,
        tag: 'te8038',
        categoria: "d11",
        disponivel: true,
    },
    {
        id: 18,
        tag: 'te8039',
        categoria: "d11",
        disponivel: true,
    },
    {
        id: 19,
        tag: 'te8040',
        categoria: "d11",
        disponivel: true,
    },
    {
        id: 20,
        tag: 'eh9502',
        categoria: "ehgp",
        disponivel: true,
    },
    {
        id: 21,
        tag: 'eh9503',
        categoria: "ehgp",
        disponivel: true,
    },
    {
        id: 22,
        tag: 'eh9504',
        categoria: "ehgp",
        disponivel: true,
    },
    {
        id: 23,
        tag: 'eh9505',
        categoria: "ehgp",
        disponivel: true,
    },
    {
        id: 24,
        tag: 'cb6502',
        categoria: "cat777",
        disponivel: true,
    },
    {
        id: 25,
        tag: 'cb6503',
        categoria: "cat777",
        disponivel: true,
    },
    {
        id: 26,
        tag: 'cb6504',
        categoria: "cat777",
        disponivel: true,
    },
    {
        id: 27,
        tag: 'te8041',
        categoria: "d11",
        disponivel: true,
    },
    {
        id: 28,
        tag: 'dg8301',
        categoria: "dragline",
        disponivel: true,
    },
];



// -----------------------------VARIÁVEIS DE BANCO DE DADOS-----------------------------
// USADA PARA GUARDAR OS EQUIPAMENTOS DISPONÍVEIS DO BANCO DE DADOS;
var equipamentosDisponiveis;

// USADA PARA GUARDAR OS OPERADORES DISPONÍVEIS DO BANCO DE DADOS;
var operadoresDisponiveis;

// USADA PARA GUARDAR A ESCALA FINAL;
var escala;

var listaEscalas = [];

// ---------------------------------------------------------------------------------------



// -----------------------------VARIÁVEIS DE EVENTOS-----------------------------
var tela2 = document.querySelector('.bodyEscalaContainer');
var tela3 = document.querySelector('.bodyConfiguracoesContainer');
var tela4 = document.querySelector('.bodyEditarEscalaContainer');
var ulListaEscalas = document.querySelector('.listaContainer > ul');

var btnTela2Voltar = document.querySelector('[tela2Voltar]');
var btnMostrarTela2 = document.querySelector('[novaEscala]');
var btnTela3Voltar = document.querySelector('[tela3Voltar]');
var btnMostrarTela3 = document.querySelectorAll('[configuracao]');
var btnTela4Voltar = document.querySelector('[tela4Voltar]');


var btnGerarEscala = document.querySelector('[gerarEscala]');
var btnSalvarEscala = document.querySelector('[salvar]');
var btnEditarEscala = document.querySelectorAll('.edit');

var btnSalvarEdicao = document.querySelector('[salvarEdicao]');

// ---------------------------------------------------------------------------------------


function renderizarConfiguracoes() {
    let ulListaOperadores = document.querySelector('[listaOperadores]');
    let ulListaEquipamentos = document.querySelector('[listaEquipamentos]');


    ulListaOperadores.innerHTML = '';
    ulListaEquipamentos.innerHTML = '';

    operadores.forEach((operador, index) => {
        ulListaOperadores.innerHTML += `
                                <li id="${index}">
                                    <div class="liConfiguracaoContainer">
                                        <div class="operadorEEquipamentoNome">${operador.nome}</div>
                                        <div class="operadorEEquipamentoStatus">${operador.disponivel ? "Disponível" : "Indisponível"}</div>
                                        <div class="controlesConfiguracaoContainer">
                                            
                                            <div class="switchContainer ${operador.disponivel ? "active" : ""}" operadorSwitch${index}>
                                                <span class='toggleButton'  ></span>
                                            </div>
                                        </div>
                                    </div>
                                </li>
        `;
    });

    equipamentos.forEach((equipamento, index) => {
        ulListaEquipamentos.innerHTML += `
                                <li id="${index}">
                                <div class="liConfiguracaoContainer">
                                    <div class="operadorEEquipamentoNome">${equipamento.tag.toUpperCase()}</div>
                                    <div class="operadorEEquipamentoStatus">${equipamento.disponivel ? "Disponível" : "Indisponível"}</div>
                                    <div class="controlesConfiguracaoContainer">
                                        
                                            <div class="switchContainer ${equipamento.disponivel ? "active" : ""}" equipamentoSwitch${index}>
                                                <span class='toggleButton'  ></span>
                                            </div>                                        
                                    </div>
                                </div>
                            </li>
        `;
    });

    let lisEsquipamentos = document.querySelectorAll('[listaEquipamentos] > li');
    let lisOperadores = document.querySelectorAll('[listaOperadores] > li');

    lisEsquipamentos.forEach((li, index) => {
        let btnSwitch = document.querySelector(`[equipamentoSwitch${index}]`);

        btnSwitch.addEventListener('click', () => {
            // let btnToggle = document.querySelector(`[equipamentoSwitch${index}]`);
            btnSwitch.classList.toggle('active');
            equipamentos[index].disponivel = !equipamentos[index].disponivel;

            let divEquipamentoStatus = li.querySelector(`.operadorEEquipamentoStatus`);
            divEquipamentoStatus.innerText = '';
            divEquipamentoStatus.innerText = equipamentos[index].disponivel ? "Disponível" : "Indisponível";

            // console.log(equipamentos[index].disponivel);
            // renderizarConfiguracoes();
        });
    });

    lisOperadores.forEach((li, index) => {
        let btnSwitch = document.querySelector(`[operadorSwitch${index}]`);

        btnSwitch.addEventListener('click', () => {
            btnSwitch.classList.toggle('active');
            operadores[index].disponivel = !operadores[index].disponivel;

            let divOperadorStatus = li.querySelector(`.operadorEEquipamentoStatus`);
            divOperadorStatus.innerText = '';
            divOperadorStatus.innerText = operadores[index].disponivel ? "Disponível" : "Indisponível";
            // console.log(divOperadorStatus)

            // renderizarConfiguracoes();
        });
    });
}

function resetarParametros() {
    equipamentosDisponiveis = equipamentos.filter((equipamento) => equipamento.disponivel == true);
    operadoresDisponiveis = operadores.filter((operador) => operador.disponivel == true);
    escala = [];
}

function montarEscala(tag, nome) {

    let operadorEquipamento = {
        equipamento: tag,
        operador: nome,
        local: 'local adicionado',
        transporte: 'transporte adicionado',
        atividade: 'atividade adicionada',
    }

    escala.push(operadorEquipamento);
}

function montarListaEscalas(escala) {
    let date = new Date();
    let ano = date.getFullYear();
    let mes = date.getMonth() + 1;
    let dia = date.getDate();
    let hora = date.getHours();
    let minuto = date.getMinutes();
    let segundo = date.getSeconds();

    let escalas = {
        dataCriacao: `${ano}-${mes}-${dia}`,
        horarioCriacao: `${hora}:${minuto}:${segundo}`,
        nome: `Escala ${listaEscalas.length == 0 ? 1 : listaEscalas.length + 1}`,
        escala: escala,
    }

    listaEscalas.unshift(escalas);
}

function mostrarEscala() {
    resetarParametros();
    let contador = 0;
    console.log('mostrando escala');

    while (equipamentosDisponiveis.length > 0 && operadoresDisponiveis.length > 0) {
        if (contador <= 20) {
            console.log('escala 1');
            resetarParametros();
            gerarEscala(1);
            contador++;
        } else if (contador <= 40) {
            console.log('escala 2');
            resetarParametros();

            gerarEscala(2);
            contador++;
        } else if (contador <= 60) {
            console.log('escala 3');
            resetarParametros();

            gerarEscala(3);
            contador++;
        } else if (contador <= 80) {
            console.log('escala 4');
            resetarParametros();

            gerarEscala(4);
            contador++;
        } else {
            console.log('Intervenção necessária!');
            break;
        }
    }

    console.log('repetições: ' + contador);
    console.log('escala: ');
    // console.log(escala.sort((a, b) => {
    //     return a.equipamento < b.equipamento ? -1 : a.equipamento > b.equipamento ? 1 : 0;
    // }));
    console.log(escala);

    console.log('operadores fora de escala: ');
    console.log(operadoresDisponiveis);
    console.log('equipamentos sem operador: ');
    console.log(equipamentosDisponiveis);
}

function gerarEscala(tipo) {
    if (tipo == 1) {
        escala1();
    } else if (tipo == 2) {
        escala2();
    } else if (tipo == 3) {
        escala3();
    } else if (tipo == 4) {
        escala4();
    }
}

// --------------FUNÇÕES QUE ESCALAM OS EQUIPAMENTOS-----------
function escalarDragline() {
    if ((
        (equipamentosDisponiveis.filter((equipamento) => equipamento.categoria == "dragline")).length != 0
    ) && (
            operadoresDisponiveis.filter((operador) => operador.habilitado.dragline == true).length != 0
        )) {
        // console.log('dragline disponível. Quantidade: ' + (equipamentosDisponiveis.filter((equipamento) => equipamento.categoria == "dragline")).length);


        let draglines = equipamentosDisponiveis.filter((equipamento) => equipamento.categoria == "dragline");
        let operadores = operadoresDisponiveis.filter((operador) => operador.habilitado.dragline == true);

        while ((draglines.length > 0) && (operadores.length > 0)) {
            let equipamento = draglines[Math.floor(Math.random() * draglines.length)];
            let operador = operadores[Math.floor(Math.random() * operadores.length)];

            equipamentosDisponiveis.splice(equipamentosDisponiveis.indexOf(equipamento), 1);
            operadoresDisponiveis.splice(operadoresDisponiveis.indexOf(operador), 1);

            draglines.splice(draglines.indexOf(equipamento), 1);
            operadores.splice(operadores.indexOf(operador), 1);

            // console.log(equipamentosDisponiveis);
            // console.log(operadoresDisponiveis);

            montarEscala(equipamento.tag, operador.nome);


            // console.log('escala: ');
            // console.log(escala);
        }
    }
}

function escalarEHGP(preferencia = false) {
    if ((
        (equipamentosDisponiveis.filter((equipamento) => equipamento.categoria == "ehgp")).length != 0
    ) && (
            operadoresDisponiveis.filter((operador) => operador.habilitado.ehgp == true).length != 0
        )
    ) {


        let escavadeiras = equipamentosDisponiveis.filter((equipamento) => equipamento.categoria == "ehgp");
        let operadores = operadoresDisponiveis.filter((operador) => operador.habilitado.ehgp == true);


        // PARTE RESPONSÁVEL PELA PREFERÊNCIA DOS OPERADORES DE ESCAVADEIRA

        if (preferencia) {
            if (operadores.filter((operador) => (operador.habilitado.d11 == false && operador.habilitado.cat777 == false && operador.habilitado.dragline == false)).length > 0) {
                let operadoresApenasEhgp = operadores.filter((operador) => (operador.habilitado.d11 == false && operador.habilitado.cat777 == false && operador.habilitado.dragline == false))

                while ((escavadeiras.length > 0) && (operadoresApenasEhgp.length > 0)) {
                    let equipamento = escavadeiras[Math.floor(Math.random() * escavadeiras.length)];
                    let operador = operadoresApenasEhgp[Math.floor(Math.random() * operadoresApenasEhgp.length)];

                    equipamentosDisponiveis.splice(equipamentosDisponiveis.indexOf(equipamento), 1);
                    operadoresDisponiveis.splice(operadoresDisponiveis.indexOf(operador), 1);

                    escavadeiras.splice(escavadeiras.indexOf(equipamento), 1);
                    operadores.splice(operadores.indexOf(operador), 1);
                    operadoresApenasEhgp.splice(operadoresApenasEhgp.indexOf(operador), 1);

                    montarEscala(equipamento.tag, operador.nome);

                    // console.log(escala);
                }
            }
        }

        while ((escavadeiras.length > 0) && (operadores.length > 0)) {
            let equipamento = escavadeiras[Math.floor(Math.random() * escavadeiras.length)];
            let operador = operadores[Math.floor(Math.random() * operadores.length)];

            equipamentosDisponiveis.splice(equipamentosDisponiveis.indexOf(equipamento), 1);
            operadoresDisponiveis.splice(operadoresDisponiveis.indexOf(operador), 1);

            escavadeiras.splice(escavadeiras.indexOf(equipamento), 1);
            operadores.splice(operadores.indexOf(operador), 1);

            montarEscala(equipamento.tag, operador.nome);


        }
    }
}

function escalarCat777(preferencia = false) {
    if ((
        equipamentosDisponiveis.filter((equipamento) => equipamento.categoria == "cat777").length != 0
    ) && (
            operadoresDisponiveis.filter((operador) => operador.habilitado.cat777 == true).length != 0
        )
    ) {

        let caminhoes = equipamentosDisponiveis.filter((equipamento) => equipamento.categoria == "cat777");
        let operadores = operadoresDisponiveis.filter((operador) => operador.habilitado.cat777 == true);


        // PARTE RESPONSÁVEL PELA PREFERÊNCIA DOS OPERADORES

        if (preferencia) {
            if (operadores.filter((operador) => (operador.habilitado.d11 == false && operador.habilitado.ehgp == false && operador.habilitado.dragline == false)).length > 0) {
                let operadoresApenasCat777 = operadores.filter((operador) => (operador.habilitado.d11 == false && operador.habilitado.ehgp == false))

                while ((caminhoes.length > 0) && (operadoresApenasCat777.length > 0)) {
                    let equipamento = caminhoes[Math.floor(Math.random() * caminhoes.length)];
                    let operador = operadoresApenasCat777[Math.floor(Math.random() * operadoresApenasCat777.length)];

                    equipamentosDisponiveis.splice(equipamentosDisponiveis.indexOf(equipamento), 1);
                    operadoresDisponiveis.splice(operadoresDisponiveis.indexOf(operador), 1);

                    caminhoes.splice(caminhoes.indexOf(equipamento), 1);
                    operadores.splice(operadores.indexOf(operador), 1);
                    operadoresApenasCat777.splice(operadoresApenasCat777.indexOf(operador), 1);

                    montarEscala(equipamento.tag, operador.nome);
                }
            }
        }

        while ((caminhoes.length > 0) && (operadores.length > 0)) {
            let equipamento = caminhoes[Math.floor(Math.random() * caminhoes.length)];
            let operador = operadores[Math.floor(Math.random() * operadores.length)];

            equipamentosDisponiveis.splice(equipamentosDisponiveis.indexOf(equipamento), 1);
            operadoresDisponiveis.splice(operadoresDisponiveis.indexOf(operador), 1);

            caminhoes.splice(caminhoes.indexOf(equipamento), 1);
            operadores.splice(operadores.indexOf(operador), 1);

            montarEscala(equipamento.tag, operador.nome);
        }
    }
}

function escalarD11() {
    if ((
        equipamentosDisponiveis.filter((equipamento) => equipamento.categoria == "d11").length != 0
    ) && (
            operadoresDisponiveis.filter((operador) => operador.habilitado.d11 == true).length != 0
        )) {

        let d11 = equipamentosDisponiveis.filter((equipamento) => equipamento.categoria == "d11");
        let operadores = operadoresDisponiveis.filter((operador) => operador.habilitado.d11 == true);



        while ((d11.length > 0) && (operadores.length > 0)) {



            let equipamento = d11[Math.floor(Math.random() * d11.length)];
            let operador = operadores[Math.floor(Math.random() * operadores.length)];

            equipamentosDisponiveis.splice(equipamentosDisponiveis.indexOf(equipamento), 1);
            operadoresDisponiveis.splice(operadoresDisponiveis.indexOf(operador), 1);

            d11.splice(d11.indexOf(equipamento), 1);
            operadores.splice(operadores.indexOf(operador), 1);

            montarEscala(equipamento.tag, operador.nome);

        }

    }
}
// --------------------------------------------------------------




// escala totalmente aleatória
function escala1() {

    // ESCALANDO DRAGLINE
    escalarDragline();

    // ESCALANDO EHGP
    escalarEHGP();

    // ESCALANDO CAT777
    escalarCat777();

    // ESCALANDO D11
    escalarD11();

}

// escala aleatória, mas quem opera apenas escavadeiras será escalado com preferência
function escala2() {

    // ESCALANDO DRAGLINE
    escalarDragline();

    // ESCALANDO EHGP
    escalarEHGP(true);

    // ESCALANDO CAT777
    escalarCat777();

    // ESCALANDO D11
    escalarD11();
}

// escala aleatória, mas quem opera apenas cat777 será escalado com preferência
function escala3() {
    escalarDragline();

    // ESCALANDO EHGP
    escalarEHGP();

    // ESCALANDO CAT777
    escalarCat777(true);

    // ESCALANDO D11
    escalarD11();
}

// ESCALA ALEATÓRIA, MAS QUEM OPERA APENAS CAT777 E QUEM OPERA APENAS EHGP SERÁ ESCALADO COM PREFERÊNCIA
function escala4() {

    // ESCALANDO DRAGLINE
    escalarDragline();

    // ESCALANDO EHGP
    escalarEHGP(true);

    // ESCALANDO CAT777
    escalarCat777(true);

    // ESCALANDO D11
    escalarD11();
}

function atualizarTelaEscalas() {
    ulListaEscalas.innerHTML = '';
    listaEscalas.forEach((escala, index) => {
        ulListaEscalas.innerHTML += `
        <li id="${index}">
            <div class="liContainer">
                <div>${escala.nome}</div>
                <div>${escala.dataCriacao} ${escala.horarioCriacao}</div>
                <div class="controlesContainer">
                    <a class="icon" deletarEscala${index}>
                        <img src="./images/delete_FILL0_wght400_GRAD0_opsz24.png" alt="" srcset="">
                    </a>
                    <a class="icon" infoEscala${index}>
                        <img src="./images/info_FILL0_wght400_GRAD0_opsz24.png" alt="" srcset="">
                    </a>
                </div>
            </div>
        </li>
        `;
    });

    let lis = document.querySelectorAll(`.listaContainer > ul > li`);
    lis.forEach((li, index) => {
        let btnDeletarEscala = document.querySelector(`[deletarEscala${index}]`);
        let btnInfoEscala = document.querySelector(`[infoEscala${index}]`);

        // PARTE RESPONSÁVEL POR DELETAR A ESCALA
        btnDeletarEscala.addEventListener('click', () => {
            listaEscalas.splice(listaEscalas.indexOf(li), 1);
            // console.log(li);
            atualizarTelaEscalas();
        });

        // PARTE RESPONSÁVEL POR DETALHES DA ESCALA
        btnInfoEscala.addEventListener('click', () => {
            let escala = listaEscalas[index].escala;
            let containerEscala = document.querySelector('.escalaContainer');
            let textoDeGeracao = `
            <div class="creditsEscalaContainer" detalhesCriacao>
                <p>Generated in <strong>${listaEscalas[index].dataCriacao} at ${listaEscalas[index].horarioCriacao}</strong></p>
                <p>GEMIN / GADEM</p>

            </div>

            `;

            mostrarTela2();

            btnGerarEscala.hidden = true;
            btnMostrarTela3.hidden = true;
            btnSalvarEscala.hidden = true;

            renderizarEscala(escala);

            let range = document.createRange();
            containerEscala.appendChild(range.createContextualFragment(textoDeGeracao));

        });
    });


}


// FUNÇÕES DOS BOTÕES DE EVENTOS
// ----------------------------------------------------------------
function removerCheck(tds) {
    tds.forEach(td => {
        let tdTexto = td.innerText;
        td.innerHTML = '' + tdTexto;
    })
}

function renderizarEscala(escala){
    let tbody = document.querySelector('tbody');
            tbody.innerHTML = '';
            escala.forEach((element, index) => {
                let novaLinha = `
                            <tr id=${index}>
                                <td col1>
                                ${element.equipamento}
                                </td>
                                <td col2>
                                ${element.operador}
                                </td>
                                <td col3>
                                ${element.local}
                                </td>
                                <td col4>
                                ${element.transporte}
                                </td>
                                <td col5>
                                ${element.atividade}
                                </td>
                            </tr>
            
            `;
                tbody.innerHTML += novaLinha;
            });
}

function mostrarTela3() {
    renderizarConfiguracoes();
    tela3.classList.remove('esconder');
    tela3.classList.add('mostrar');
}

function mostrarTela2() {
    let containerEscala = document.querySelector('.escalaContainer');
    let textoGeracao = document.querySelector('.creditsEscalaContainer');

    tela2.classList.remove('esconder');
    tela2.classList.add('mostrar');

    if (textoGeracao !== null) {
        containerEscala.removeChild(textoGeracao);
    }

    btnGerarEscala.hidden = false;
    btnSalvarEscala.hidden = false;
    btnMostrarTela3.hidden = false;
}

function mostrarTela4() {
    tela4.classList.remove('esconder');
    tela4.classList.add('mostrar');
}



function atribuirEventos() {
    btnMostrarTela2.addEventListener('click', mostrarTela2)

    btnMostrarTela3.forEach((btn) => {
        btn.addEventListener('click', mostrarTela3);
    });


    // BOTAO VOLTAR DA TELA 2
    btnTela2Voltar.addEventListener('click', () => {
        btnSalvarEscala.disabled = true;
        tela2.classList.add('esconder');
        tela2.classList.remove('mostrar');

        //limpa a tela de escalas ao voltar
        resetarParametros();
        let tbody = document.querySelector('tbody');
        tbody.innerHTML = '';
    });

    btnTela4Voltar.addEventListener('click', () => {
        tela4.classList.remove('mostrar');
        tela4.classList.add('esconder');

        let checkboxes = document.querySelectorAll('[type = checkbox]');

        checkboxes.forEach((check, index) => {
            check.parentElement.innerHTML = '' + check.parentElement.innerText;
        });
    });

    btnTela3Voltar.addEventListener('click', () => {
        tela3.classList.add('esconder');
        tela3.classList.remove('mostrar');
    });

    btnGerarEscala.addEventListener('click', () => {
        btnSalvarEscala.disabled = false;
        mostrarEscala();
        renderizarEscala(escala);
    });

    btnSalvarEscala.addEventListener('click', () => {
        btnSalvarEscala.disabled = true;

        montarListaEscalas(escala);
        tela2.classList.add('esconder');
        tela2.classList.remove('mostrar');

        //limpa a tela de escalas ao voltar
        resetarParametros();
        let tbody = document.querySelector('tbody');
        tbody.innerHTML = '';
        // alert('salvo com sucesso!');

        atualizarTelaEscalas();

    });


    btnSalvarEdicao.addEventListener('click', () => {
        let input = document.querySelector(`[inputMudanca]`);
        let checkboxes = document.querySelectorAll('[type = checkbox]');

        checkboxes.forEach((check, index) => {
            if (input.value != "") {
                if (check.checked) {
                    check.parentElement.innerHTML = input.value;
                } else {
                    check.parentElement.innerHTML = '' + check.parentElement.innerText;
                }
            }
        });
    });

    btnEditarEscala.forEach((btnEditar, index) => {
        btnEditar.addEventListener('click', () => {
            let tds = document.querySelectorAll(`td[col${index + 2}]`);
            console.log('clicando');
            // verifica de tem escala gerada
            if (tds.length != 0) {
                mostrarTela4();
                // verifica se tem checkbox em tela
                if (document.querySelectorAll('[type = checkbox]').length == 0) {
                    console.log('adicionando check');
                    tds.forEach(td => {
                        let input = `<input type="checkbox">`;
                        td.innerHTML = input + td.innerHTML;
                    });
                } else {
                    removerCheck(tds);
                }
            }
        });
    });
}


equipamentos.sort((a, b) => {
    return a.tag < b.tag ? -1 : a.tag > b.tag ? 1 : 0;
})

operadores.sort((a, b) => {
    return a.nome < b.nome ? -1 : a.nome > b.nome ? 1 : 0;
})

window.addEventListener('load', () => {
    atribuirEventos();

    if (listaEscalas.length > 0) {
        atualizarTelaEscalas();
    }

    renderizarConfiguracoes();
});


localStorage()